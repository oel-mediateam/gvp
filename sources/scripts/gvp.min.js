/*
 * Generic Video Player (GVP) JS
 *
 * @author: Ethan Lin
 * @url: https://github.com/oel-mediateam/gvp
 * @version: 3.3.3
 *
 * @license: The MIT License (MIT)
 * Copyright (c) 2014-2016 UWEX CEOEL
 *
 */
var ROOT_PATH="https://media.uwex.edu/app/generic_video_player_v3/";$(document).ready(function(){function t(t){var e="[\\?&]"+t+"=([^&#]*)",i=new RegExp(e),n=i.exec(window.location.href);return t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}function e(t){var e=t,i=e.split(" "),n,a,o,r=[],s;for(o=0;o<i.length;o++)n=i[o].substring(0,1).toUpperCase(),a=i[o].substring(1),r[o]=n+a;return s=r.join(" ")}function i(){""!==$.trim(t("ttl"))&&$(".title_bar").html(e($.trim(t("ttl")))),""!==$.trim(t("intro"))&&Number($.trim(t("intro")))&&(c=$.trim(t("intro"))),""!==$.trim(t("w"))&&(d=Number($.trim(t("w")))),""!==$.trim(t("h"))&&(p=Number($.trim(t("h")))),""!==$.trim(t("autoplay"))&&(u=Number($.trim(t("autoplay"))))}function n(){var t=window.location.href,e;e=t.split("?"),e=e[0].split("/"),e=e[e.length-2],m=e.toLowerCase(),$.get("kaltura.txt",function(t){v=t.trim(),f=!0}).always(l)}function a(){$(".video_holder").html('<video id="gvp_video" class="video-js vjs-default-skin"></video>');var t={techOrder:["html5","flash"],width:d,height:p,controls:!0,poster:m+".jpg",autoplay:!!u,preload:"auto"};f&&(t.poster="https://cdnsecakmi.kaltura.com/p/1660872/sp/166087200/thumbnail/entry_id/"+v+"/width/"+d+"/height/"+p),videojs("gvp_video",t,function(){this.src([{type:"video/mp4",src:"https://media.uwex.edu/content/media/intro_videos/"+c+".mp4"},{type:"video/webm",src:"https://media.uwex.edu/content/media/intro_videos/"+c+".webm"}]),this.on("ended",function(){this.dispose(),o(),c=0})})}function o(){$(".video_holder").html('<video id="gvp_video" class="video-js vjs-default-skin" crossorigin="anonymous"></video>');var t=$("#gvp_video");g={techOrder:["html5","flash"],width:d,height:p,controls:!0,poster:m+".jpg",autoplay:!!u,preload:"metadata",plugins:null},f?$.getScript(ROOT_PATH+"scripts/mwembedloader.js",function(){$.getScript(ROOT_PATH+"scripts/kwidget.getsources.js",function(){var e,i,n,a,o,l,d="";kWidget.getSources({partnerId:1660872,entryId:v,callback:function(p){e=p.entryId,i=p.captionId,n=p.captionExt,a=p.captionLang,l=p.duration,o="https://cdnsecakmi.kaltura.com/p/1660872/sp/166087200/thumbnail/entry_id/"+e+"/width/"+g.width+"/height/"+g.height,$(".title_bar").html(p.name);for(var c in p.sources){var u=p.sources[c];487041===u.flavorParamsId&&(w.low=u.src,d.length<=0&&(d=u.src)),487081===u.flavorParamsId&&(w.normal=u.src,d.length<=0&&(d=u.src)),487061===u.flavorParamsId&&(w.medium=u.src,d.length<=0&&(d=u.src)),487111===u.flavorParamsId&&(w.webm=u.src)}null!==i&&t.append('<track kind="subtitles" src="https://www.kaltura.com/api_v3/?service=caption_captionasset&action=servewebvtt&captionAssetId='+i+"&segmentDuration="+l+'&segmentIndex=1" srclang="en" label="English">'),g.poster=o,g.plugins={videoJsResolutionSwitcher:{default:720}},r(),s(d)}})})}):$.get(m+".vtt",function(){t.append('<track src="'+m+'.vtt" kind="subtitles" srcland="en" label="English" />')}).always(function(){t.append('<source src="'+m+'.mp4" type="video/mp4" />'),r(),s("")})}function r(){$.fn.supportMp4()===!1&&$.fn.supportWebm()===!1&&(g.techOrder=["flash","html5"],g.plugins=null),videojs("gvp_video",g,function(){var t=this;0===c&&this.on("loadedmetadata",function(){this.play()}),this.on("ended",function(){$(".vjs-poster").delay(3e3).queue(function(){$(this).html('<span class="replay-button"></span>').show(),t.currentTime(0)}),$(".vjs-poster").on("click",function(){$(".vjs-poster").hide(),t.play()})}),f&&this.updateSrc([{src:w.low,type:"video/mp4",label:"low",res:"360"},{src:w.normal,type:"video/mp4",label:"normal",res:"720"},{src:w.medium,type:"video/mp4",label:"medium",res:"640"}])}),videojs.options.flash.swf=ROOT_PATH+"videoplayer/video-js.swf"}function s(t){var e=$("#download_bar ul"),i,n=window.location.href;n=n.substr(0,n.lastIndexOf("/")+1),i=n+m,t.length>=1?(e.append('<li><a download="'+m+'.mp4" href="'+t+'" target="_blank">Video</a></li>'),$.get(n+m+".pdf",function(){e.append('<li><a download="'+m+'.pdf" href="'+i+'.pdf" target="_blank">Transcript</a></li>')}).always(function(){$.get(n+m+".zip",function(){e.append('<li><a href="'+i+'.zip" target="_blank">Supplement</a></li>')})})):$.get(n+m+".mp4",function(){e.append('<li><a download="'+m+'.mp4" href="'+i+'.mp4" target="_blank">Video</a></li>')}).always(function(){$.get(n+m+".mp3",function(){e.append('<li><a download="'+m+'.mp3" href="'+i+'.mp3" target="_blank">Audio</a></li>')}).always(function(){$.get(n+m+".pdf",function(){e.append('<li><a download="'+m+'.pdf" href="'+i+'.pdf" target="_blank">Transcript</a></li>')}).always(function(){$.get(n+m+".zip",function(){e.append('<li><a href="'+i+'.zip" target="_blank">Supplement</a></li>')})})})})}function l(){if(window.self===window.top){var t=new Date,i=location.href,n="";$.each(h,function(t){return h[t]===i.split("/")[4]?(n="msmgt"===h[t]?"smgt":h[t],!1):void(n="default")}),$("body").addClass(n),$(".gvp_wrapper").prepend('<div class="logo"></div>'),$(".gvp_wrapper").append('<div class="footer">Copyright &copy; '+t.getFullYear()+". University of Wisconsin System. All rights reserved.</div>")}$(document).attr("title",$(".title_bar").html().length<=0?e($.trim(m.replace(/\_+/g," "))):$(".title_bar").html()),$(".gvp_wrapper").css({width:d+"px"}),c>0?a():o(),$(".video_holder").click(function(){window.self!==window.top&&$(".title_bar").hide()})}var d=640,p=360,c=-1,u=0,m,h=["smgt","msmgt","hwm","himt","bps","il","flx","ds"],f=!1,v,g,w={};i(),n()}),$.fn.supportWebm=function(){return!!document.createElement("video").canPlayType('video/webm; codecs="vp8.0, vorbis"')},$.fn.supportMp4=function(){return!!document.createElement("video").canPlayType('video/mp4; codecs="avc1.4D401E, mp4a.40.2"')};