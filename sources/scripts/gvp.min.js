/*
 * Generic Video Player (GVP) JS
 *
 * @author: Ethan Lin
 * @url: https://github.com/oel-mediateam/gvp
 * @version: 3.2.4
 *
 * @license: The MIT License (MIT)
 * Copyright (c) 2014 UW-EX CEOEL
 *
 */
document.createElement("video"),document.createElement("audio"),document.createElement("track");var ROOT_PATH="https://media.uwex.edu/app/generic_video_player_v3/";$(document).ready(function(){function e(e){var t="[\\?&]"+e+"=([^&#]*)",o=new RegExp(t),i=o.exec(window.location.href);return e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))}function t(e){var t=e,o=t.split(" "),i,r,n,s=[],d;for(n=0;n<o.length;n++)i=o[n].substring(0,1).toUpperCase(),r=o[n].substring(1),s[n]=i+r;return d=s.join(" ")}function o(){""!==$.trim(e("ttl"))&&$(".title_bar").html(t($.trim(e("ttl")))),""!==$.trim(e("intro"))&&Number($.trim(e("intro")))&&(m=$.trim(e("intro"))),""!==$.trim(e("w"))&&(l=Number($.trim(e("w")))),""!==$.trim(e("h"))&&(c=Number($.trim(e("h"))))}function i(){var e=window.location.href,t;t=e.split("?"),t=t[0].split("/"),t=t[t.length-2],h=t.toLowerCase()}function r(){$(".video_holder").html('<video id="gvp_video" class="video-js vjs-default-skin"></video>'),videojs("gvp_video",{width:l,height:c,controls:!0,poster:h+".jpg",autoplay:!1,preload:"metadata"},function(){u=this,this.src([{type:"video/mp4",src:""+ROOT_PATH+"intro_videos/"+m+".mp4"},{type:"video/webm",src:""+ROOT_PATH+"intro_videos/"+m+".webm"}])}),u.on("error",function(){var e=a(m,"mp4","video/mp4"),t=a(m,"webm","video/webm");e===!1&&this.src([{type:"video/webm",src:h+".webm"}]),t===!1&&this.src([{type:"video/mp4",src:h+".mp4"}]),t===!1&&e===!1&&(this.dispose(),$(".video_holder").html('<p class="error">Video Error: intro video not found!<small>Intro video code '+m+' is not found or does not exist on the centralized location. Please double check the intro video code table for the correct intro video number.</small></p><p class="error">If you see this message, both MP4 and WebM are not found.</p>'))}),u.on("ended",function(){this.dispose(),n()})}function n(){var e=a(h,"vtt","text/vtt")?e='<track src="'+h+'.vtt" kind="subtitles" srcland="en" label="English" />':"";$(".video_holder").html('<video id="gvp_video" class="video-js vjs-default-skin">'+e+"</video>"),videojs("gvp_video",{width:l,height:c,controls:!0,poster:h+".jpg",autoplay:!1,preload:"metadata"},function(){v=this,this.progressTips(),this.src([{type:"video/mp4",src:h+".mp4"},{type:"video/webm",src:h+".webm"}]),m&&this.play()}),videojs.options.flash.swf=""+ROOT_PATH+"videoplayer/video-js.swf",v.on("error",function(){var e=a(h,"mp4","video/mp4"),t=a(h,"webm","video/webm");e===!1&&this.src([{type:"video/webm",src:h+".webm"}]),t===!1&&this.src([{type:"video/mp4",src:h+".mp4"}]),e===!1&&t===!1&&(this.dispose(),$(".video_holder").html('<p class="error">Video Error: video not found!<small>Video file "<strong>'+h+'</strong>" is not found. Please double check the video file name. The file name must match the directory name.</small></p><p class="error">If you see this message, both MP4 and WebM are not found.</p>'))}),v.on("ended",function(){this.currentTime(0),$(".vjs-poster").delay(6e3).queue(function(){$(this).css("background-image","url("+h+".jpg)").html('<span class="replay-button"></span>').show()})})}function s(e,t){var o;"pdf"===t?o="application/pdf":"mp3"===t?o="audio/mpeg":"mp4"===t&&(o="video/mp4"),$.ajax({url:e+"."+t,type:"HEAD",dataType:"text",contentType:o,async:!1,beforeSend:function(e){e.overrideMimeType(o),e.setRequestHeader("Accept",o)},success:function(){var o=e,i=$("#download_bar ul");if("http:"!==location.protocol){var r=window.location.href;r=r.substr(0,r.lastIndexOf("/")+1).replace("https","http"),o=r+e}"pdf"===t?i.append('<li><a href="'+o+"."+t+'" target="_blank">Transcript</a></li>'):"mp3"===t?i.append('<li><a href="'+o+"."+t+'" target="_blank">Audio</a></li>'):"mp4"===t&&i.append('<li><a href="'+o+"."+t+'" target="_blank">Video</a></li>')},error:function(){}})}function d(){s(h,"mp4"),s(h,"mp3"),s(h,"pdf")}function a(e,t,o){var i=!1;return $.ajax({url:e+"."+t,type:"HEAD",dataType:"text",contentType:o,async:!1,beforeSend:function(e){e.overrideMimeType(o),e.setRequestHeader("Accept",o)},success:function(){i=!0},error:function(){i=!1}}),i}function p(){if(window.self===window.top){var e=new Date,o=location.href,i="";$.each(f,function(e){return f[e]===o.split("/")[4]?(i="msmgt"===f[e]?"smgt":f[e],!1):void(i="default")}),$("body").addClass(i),$(".gvp_wrapper").prepend('<div class="logo"></div>'),$(".gvp_wrapper").append('<div class="footer">Copyright &copy; '+e.getFullYear()+". University of Wisconsin System. All rights reserved.</div>")}$(document).attr("title",$(".title_bar").html().length<=0?t($.trim(h.replace(/\_+/g," "))):$(".title_bar").html()),$(".gvp_wrapper").css({width:l+"px"}),m?r():n(!0),$(".video_holder").click(function(){window.self!==window.top&&$(".title_bar").hide()})}var l=640,c=360,m=0,u,v,h,f=["smgt","msmgt","hwm","himt","bps","il","flx"];o(),i(),p(),d()});