/*
 * Generic Video Player (GVP) JS
 *
 * @author: Ethan Lin
 * @url: https://github.com/oel-mediateam/gvp
 * @version: 3.2.4
 *
 * @license: The MIT License (MIT)
 * Copyright (c) 2014 UW-EX CEOEL
 *
 */
document.createElement("video"),document.createElement("audio"),document.createElement("track");var ROOT_PATH="https://media.uwex.edu/app/generic_video_player_v3/";$(document).ready(function(){function e(e){var t="[\\?&]"+e+"=([^&#]*)",o=new RegExp(t),i=o.exec(window.location.href);return e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))}function t(e){var t=e,o=t.split(" "),i,r,n,s=[],d;for(n=0;n<o.length;n++)i=o[n].substring(0,1).toUpperCase(),r=o[n].substring(1),s[n]=i+r;return d=s.join(" ")}function o(){""!==$.trim(e("ttl"))&&$(".title_bar").html(t($.trim(e("ttl")))),""!==$.trim(e("intro"))&&Number($.trim(e("intro")))&&(c=$.trim(e("intro"))),""!==$.trim(e("w"))&&(l=Number($.trim(e("w")))),""!==$.trim(e("h"))&&(p=Number($.trim(e("h"))))}function i(){var e=window.location.href,t;t=e.split("?"),t=t[0].split("/"),t=t[t.length-2],v=t.toLowerCase()}function r(){$(".video_holder").html('<video id="gvp_video" class="video-js vjs-default-skin"></video>'),videojs("gvp_video",{width:l,height:p,controls:!0,poster:v+".jpg",autoplay:!1,preload:"metadata"},function(){m=this,this.src([{type:"video/mp4",src:"https://media.uwex.edu/content/media/intro_videos/"+c+".mp4"},{type:"video/webm",src:"https://media.uwex.edu/content/media/intro_videos/"+c+".webm"}])}),m.on("error",function(){var e=d(c,"mp4","video/mp4"),t=d(c,"webm","video/webm");e===!1&&this.src([{type:"video/webm",src:v+".webm"}]),t===!1&&this.src([{type:"video/mp4",src:v+".mp4"}]),t===!1&&e===!1&&(this.dispose(),$(".video_holder").html('<p class="error">Video Error: intro video not found!<small>Intro video code '+c+' is not found or does not exist on the centralized location. Please double check the intro video code table for the correct intro video number.</small></p><p class="error">If you see this message, both MP4 and WebM are not found.</p>'))}),m.on("ended",function(){this.dispose(),n()})}function n(){var e=d(v,"vtt","text/vtt")?e='<track src="'+v+'.vtt" kind="subtitles" srcland="en" label="English" />':"";$(".video_holder").html('<video id="gvp_video" class="video-js vjs-default-skin">'+e+"</video>"),videojs("gvp_video",{width:l,height:p,controls:!0,poster:v+".jpg",autoplay:!1,preload:"metadata"},function(){u=this,this.progressTips(),this.src([{type:"video/mp4",src:v+".mp4"},{type:"video/webm",src:v+".webm"}]),c&&this.play()}),videojs.options.flash.swf=""+ROOT_PATH+"videoplayer/video-js.swf",u.on("error",function(){var e=d(v,"mp4","video/mp4"),t=d(v,"webm","video/webm");e===!1&&this.src([{type:"video/webm",src:v+".webm"}]),t===!1&&this.src([{type:"video/mp4",src:v+".mp4"}]),e===!1&&t===!1&&(this.dispose(),$(".video_holder").html('<p class="error">Video Error: video not found!<small>Video file "<strong>'+v+'</strong>" is not found. Please double check the video file name. The file name must match the directory name.</small></p><p class="error">If you see this message, both MP4 and WebM are not found.</p>'))}),u.on("ended",function(){this.currentTime(0),$(".vjs-poster").delay(6e3).queue(function(){$(this).css("background-image","url("+v+".jpg)").html('<span class="replay-button"></span>').show()})})}function s(){var e=$("#download_bar ul"),t,o=window.location.href;o=o.substr(0,o.lastIndexOf("/")+1),t=o+v,$.get(o+v+".mp4",function(){e.append('<li><a href="'+t+'.mp4" target="_blank">Video</a></li>')}).always(function(){$.get(o+v+".mp3",function(){e.append('<li><a href="'+t+'.mp3" target="_blank">Audio</a></li>')}).always(function(){$.get(o+v+".pdf",function(){e.append('<li><a href="'+t+'.pdf" target="_blank">Transcript</a></li>')}).always(function(){$.get(o+v+".zip",function(){e.append('<li><a href="'+t+'.zip" target="_blank">Supplement</a></li>')})})})})}function d(e,t,o){var i=!1;return $.ajax({url:e+"."+t,type:"HEAD",dataType:"text",contentType:o,beforeSend:function(e){e.overrideMimeType(o),e.setRequestHeader("Accept",o)},success:function(){i=!0},error:function(){i=!1}}),i}function a(){if(window.self===window.top){var e=new Date,o=location.href,i="";$.each(h,function(e){return h[e]===o.split("/")[4]?(i="msmgt"===h[e]?"smgt":h[e],!1):void(i="default")}),$("body").addClass(i),$(".gvp_wrapper").prepend('<div class="logo"></div>'),$(".gvp_wrapper").append('<div class="footer">Copyright &copy; '+e.getFullYear()+". University of Wisconsin System. All rights reserved.</div>")}$(document).attr("title",$(".title_bar").html().length<=0?t($.trim(v.replace(/\_+/g," "))):$(".title_bar").html()),$(".gvp_wrapper").css({width:l+"px"}),c?r():n(!0),$(".video_holder").click(function(){window.self!==window.top&&$(".title_bar").hide()})}var l=640,p=360,c=0,m,u,v,h=["smgt","msmgt","hwm","himt","bps","il","flx"];o(),i(),a(),s()});