/*
 * Generic Video Player (GVP) JS
 *
 * @author: Ethan Lin
 * @url: https://github.com/oel-mediateam/gvp
 * @version: 3.3.2
 *
 * @license: The MIT License (MIT)
 * Copyright (c) 2015 UWEX CEOEL
 *
 */
var ROOT_PATH="../sources/";$(document).ready(function(){function t(t){var e="[\\?&]"+t+"=([^&#]*)",i=new RegExp(e),n=i.exec(window.location.href);return t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}function e(t){var e=t,i=e.split(" "),n,a,o,r=[],s;for(o=0;o<i.length;o++)n=i[o].substring(0,1).toUpperCase(),a=i[o].substring(1),r[o]=n+a;return s=r.join(" ")}function i(){""!==$.trim(t("ttl"))&&$(".title_bar").html(e($.trim(t("ttl")))),""!==$.trim(t("intro"))&&Number($.trim(t("intro")))&&(c=$.trim(t("intro"))),""!==$.trim(t("w"))&&(p=Number($.trim(t("w")))),""!==$.trim(t("h"))&&(d=Number($.trim(t("h"))))}function n(){var t=window.location.href,e;e=t.split("?"),e=e[0].split("/"),e=e[e.length-2],u=e.toLowerCase(),$.get("kaltura.txt",function(t){f=t.trim(),m=!0}).always(l)}function a(){$(".video_holder").html('<video id="gvp_video" class="video-js vjs-default-skin"></video>');var t={techOrder:["html5","flash"],width:p,height:d,controls:!0,poster:u+".jpg",autoplay:!1,preload:"auto"};m&&(t.poster="https://cdnsecakmi.kaltura.com/p/1660872/sp/166087200/thumbnail/entry_id/"+f+"/width/"+p+"/height/"+d),videojs("gvp_video",t,function(){this.src([{type:"video/mp4",src:"https://media.uwex.edu/content/media/intro_videos/"+c+".mp4"},{type:"video/webm",src:"https://media.uwex.edu/content/media/intro_videos/"+c+".webm"}]),this.on("ended",function(){this.dispose(),o(),c=0})})}function o(){$(".video_holder").html('<video id="gvp_video" class="video-js vjs-default-skin"></video>');var t=$("#gvp_video");v={techOrder:["html5","flash"],width:p,height:d,controls:!0,poster:u+".jpg",autoplay:!1,preload:"metadata",plugins:null},m?$.getScript(ROOT_PATH+"scripts/mwembedloader.js",function(){$.getScript(ROOT_PATH+"scripts/kwidget.getsources.js",function(){var e,i,n,a,o,l="";kWidget.getSources({partnerId:1660872,entryId:f,callback:function(p){e=p.entryId,i=p.captionId,n=p.captionExt,a=p.captionLang,o="https://cdnsecakmi.kaltura.com/p/1660872/sp/166087200/thumbnail/entry_id/"+e+"/width/"+v.width+"/height/"+v.height,$(".title_bar").html(p.name);for(var d in p.sources){var c=p.sources[d];487061===c.flavorParamsId&&(g.low=c.src,l.length<=0&&(l=c.src)),487071===c.flavorParamsId&&(g.normal=c.src,l.length<=0&&(l=c.src)),487081===c.flavorParamsId&&(g.high=c.src,l.length<=0&&(l=c.src)),487111===c.flavorParamsId&&(g.webm=c.src)}null!==i&&t.append('<track kind="subtitles" src="https://cdnapisec.kaltura.com/api_v3/index.php/service/caption_captionAsset/action/serve/captionAssetId/'+i+'" srclang="en" label="English">'),v.poster=o,v.plugins={videoJsResolutionSwitcher:{"default":720}},r(),s(l)}})})}):$.get(u+".vtt",function(){t.append('<track src="'+u+'.vtt" kind="subtitles" srcland="en" label="English" />')}).always(function(){t.append('<source src="'+u+'.mp4" type="video/mp4" />'),r(),s("")})}function r(){$.fn.supportMp4()===!1&&$.fn.supportWebm()===!1&&(v.techOrder=["flash","html5"],v.plugins=null),videojs("gvp_video",v,function(){var t=this;0===c&&this.on("loadedmetadata",function(){this.play()}),this.on("ended",function(){$(".vjs-poster").delay(3e3).queue(function(){$(this).html('<span class="replay-button"></span>').show(),t.currentTime(0)}),$(".vjs-poster").on("click",function(){$(".vjs-poster").hide(),t.play()})}),m&&this.updateSrc([{src:g.low,type:"video/mp4",label:"low",res:"360"},{src:g.normal,type:"video/mp4",label:"normal",res:"720"},{src:g.high,type:"video/mp4",label:"high",res:"1080"}])}),videojs.options.flash.swf=ROOT_PATH+"videoplayer/video-js.swf"}function s(t){var e=$("#download_bar ul"),i,n=window.location.href;n=n.substr(0,n.lastIndexOf("/")+1),i=n+u,t.length>=1?(e.append('<li><a download="'+u+'.mp4" href="'+t+'" target="_blank">Video</a></li>'),$.get(n+u+".pdf",function(){e.append('<li><a download="'+u+'.pdf" href="'+i+'.pdf" target="_blank">Transcript</a></li>')}).always(function(){$.get(n+u+".zip",function(){e.append('<li><a href="'+i+'.zip" target="_blank">Supplement</a></li>')})})):$.get(n+u+".mp4",function(){e.append('<li><a download="'+u+'.mp4" href="'+i+'.mp4" target="_blank">Video</a></li>')}).always(function(){$.get(n+u+".mp3",function(){e.append('<li><a download="'+u+'.mp3" href="'+i+'.mp3" target="_blank">Audio</a></li>')}).always(function(){$.get(n+u+".pdf",function(){e.append('<li><a download="'+u+'.pdf" href="'+i+'.pdf" target="_blank">Transcript</a></li>')}).always(function(){$.get(n+u+".zip",function(){e.append('<li><a href="'+i+'.zip" target="_blank">Supplement</a></li>')})})})})}function l(){if(window.self===window.top){var t=new Date,i=location.href,n="";$.each(h,function(t){return h[t]===i.split("/")[4]?(n="msmgt"===h[t]?"smgt":h[t],!1):void(n="default")}),$("body").addClass(n),$(".gvp_wrapper").prepend('<div class="logo"></div>'),$(".gvp_wrapper").append('<div class="footer">Copyright &copy; '+t.getFullYear()+". University of Wisconsin System. All rights reserved.</div>")}$(document).attr("title",$(".title_bar").html().length<=0?e($.trim(u.replace(/\_+/g," "))):$(".title_bar").html()),$(".gvp_wrapper").css({width:p+"px"}),c>0?a():o(),$(".video_holder").click(function(){window.self!==window.top&&$(".title_bar").hide()})}var p=640,d=360,c=-1,u,h=["smgt","msmgt","hwm","himt","bps","il","flx","ds"],m=!1,f,v,g={};i(),n()}),$.fn.supportWebm=function(){return!!document.createElement("video").canPlayType('video/webm; codecs="vp8.0, vorbis"')},$.fn.supportMp4=function(){return!!document.createElement("video").canPlayType('video/mp4; codecs="avc1.4D401E, mp4a.40.2"')};