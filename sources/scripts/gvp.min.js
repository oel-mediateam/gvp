/*
 * Generic Video Player (GVP) JS
 *
 * @author: Ethan Lin
 * @url: https://github.com/oel-mediateam/gvp
 * @version: 3.3.0
 *
 * @license: The MIT License (MIT)
 * Copyright (c) 2014 UW-EX CEOEL
 *
 */
var ROOT_PATH="https://media.uwex.edu/app/generic_video_player_v3/";$(document).ready(function(){function e(e){var t="[\\?&]"+e+"=([^&#]*)",i=new RegExp(t),n=i.exec(window.location.href);return e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}function t(e){var t=e,i=t.split(" "),n,o,a,r=[],s;for(a=0;a<i.length;a++)n=i[a].substring(0,1).toUpperCase(),o=i[a].substring(1),r[a]=n+o;return s=r.join(" ")}function i(){""!==$.trim(e("ttl"))&&$(".title_bar").html(t($.trim(e("ttl")))),""!==$.trim(e("intro"))&&Number($.trim(e("intro")))&&(c=$.trim(e("intro"))),""!==$.trim(e("w"))&&(l=Number($.trim(e("w")))),""!==$.trim(e("h"))&&(d=Number($.trim(e("h"))))}function n(){var e=window.location.href,t;t=e.split("?"),t=t[0].split("/"),t=t[t.length-2],u=t.toLowerCase(),$.get("kaltura.txt",function(e){f=e.trim(),v=!0}).always(p)}function o(){$(".video_holder").html('<video id="gvp_video" class="video-js vjs-default-skin"></video>'),videojs("gvp_video",{width:l,height:d,controls:!0,poster:u+".jpg",autoplay:!1,preload:"metadata"},function(){this.src([{type:"video/mp4",src:"https://media.uwex.edu/content/media/intro_videos/"+c+".mp4"},{type:"video/webm",src:"https://media.uwex.edu/content/media/intro_videos/"+c+".webm"}]),this.on("ended",function(){this.dispose(),a()})})}function a(){$(".video_holder").html('<video id="gvp_video" class="video-js vjs-default-skin"></video>');var e=$("#gvp_video");h={techOrder:["html5","flash"],width:l,height:d,controls:!0,poster:u+".jpg",autoplay:!1,preload:"auto",plugins:null},v?$.getScript("../sources/scripts/mwembedloader.js",function(){$.getScript("../sources/scripts/kwidget.getsources.js",function(){var t,i,n,o,a={},p;kWidget.getSources({partnerId:1660872,entryId:f,callback:function(l){t=l.entryId,i=l.captionId,n=l.captionExt,o=l.captionLang,p="https://cdnsecakmi.kaltura.com/p/1660872/sp/166087200/thumbnail/entry_id/"+t+"/width/"+h.width+"/height/"+h.height,$(".title_bar").html(l.name);for(var d in l.sources){var c=l.sources[d];487061===c.flavorParamsId&&(a.low=c.src),487071===c.flavorParamsId&&(a.normal=c.src),487081===c.flavorParamsId&&(a.high=c.src),487111===c.flavorParamsId&&(a.webm=c.src)}void 0!==a.low&&e.append('<source src="'+a.low+'" type="video/mp4" data-res="low" />'),e.append('<source src="'+a.normal+'" type="video/mp4" data-res="normal" data-default="true" />'),void 0!==a.low&&e.append('<source src="'+a.high+'" type="video/mp4" data-res="high" />'),void 0!==a.webm&&$.fn.supportWebm()&&e.append('<source src="'+a.webm+'" type="video/webm" />'),null!==i&&e.append('<track kind="subtitles" src="https://cdnapisec.kaltura.com/api_v3/index.php/service/caption_captionAsset/action/serve/captionAssetId/'+i+'" srclang="en" label="English">'),h.poster=p,h.plugins={resolutionSelector:{default_res:"normal"}},r(),s(l.downloadUrl)}})})}):$.get(u+".vtt",function(){e.append('<track src="'+u+'.vtt" kind="subtitles" srcland="en" label="English" />')}).always(function(){e.append('<source src="'+u+'.mp4" type="video/mp4" />'),r(),s("")})}function r(){$.fn.supportMp4()===!1&&$.fn.supportWebm()===!1&&(h.techOrder=["flash","html5"],h.plugins=null),videojs("gvp_video",h,function(){var e=this;this.progressTips(),c&&this.play(),this.on("ended",function(){$(".vjs-poster").delay(3e3).queue(function(){$(this).html('<span class="replay-button"></span>').show(),e.currentTime(0)}),$(".vjs-poster").on("click",function(){$(".vjs-poster").hide(),e.play()})})}),videojs.options.flash.swf=ROOT_PATH+"videoplayer/video-js.swf"}function s(e){var t=$("#download_bar ul"),i,n=window.location.href;n=n.substr(0,n.lastIndexOf("/")+1),i=n+u,e.length>=1?(t.append('<li><a href="'+e+'" target="_blank">Video</a></li>'),$.get(n+u+".pdf",function(){t.append('<li><a href="'+i+'.pdf" target="_blank">Transcript</a></li>')}).always(function(){$.get(n+u+".zip",function(){t.append('<li><a href="'+i+'.zip" target="_blank">Supplement</a></li>')})})):$.get(n+u+".mp4",function(){t.append('<li><a href="'+i+'.mp4" target="_blank">Video</a></li>')}).always(function(){$.get(n+u+".mp3",function(){t.append('<li><a href="'+i+'.mp3" target="_blank">Audio</a></li>')}).always(function(){$.get(n+u+".pdf",function(){t.append('<li><a href="'+i+'.pdf" target="_blank">Transcript</a></li>')}).always(function(){$.get(n+u+".zip",function(){t.append('<li><a href="'+i+'.zip" target="_blank">Supplement</a></li>')})})})})}function p(){if(window.self===window.top){var e=new Date,i=location.href,n="";$.each(m,function(e){return m[e]===i.split("/")[4]?(n="msmgt"===m[e]?"smgt":m[e],!1):void(n="default")}),$("body").addClass(n),$(".gvp_wrapper").prepend('<div class="logo"></div>'),$(".gvp_wrapper").append('<div class="footer">Copyright &copy; '+e.getFullYear()+". University of Wisconsin System. All rights reserved.</div>")}$(document).attr("title",$(".title_bar").html().length<=0?t($.trim(u.replace(/\_+/g," "))):$(".title_bar").html()),$(".gvp_wrapper").css({width:l+"px"}),c?o():a(!0),$(".video_holder").click(function(){window.self!==window.top&&$(".title_bar").hide()})}var l=640,d=360,c=0,u,m=["smgt","msmgt","hwm","himt","bps","il","flx"],v=!1,f,h;i(),n()}),$.fn.supportWebm=function(){return!!document.createElement("video").canPlayType('video/webm; codecs="vp8.0, vorbis"')},$.fn.supportMp4=function(){return!!document.createElement("video").canPlayType('video/mp4; codecs="avc1.4D401E, mp4a.40.2"')};