/* global videojs *//* global console */$(document).ready(function(){function u(e){var t="[\\?&]"+e+"=([^&#]*)",n=new RegExp(t),r=n.exec(window.location.href);e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");return r===null?"":decodeURIComponent(r[1].replace(/\+/g," "))}function a(e){var t=e,n=t.split(" "),r,i,s,o=[],u;for(s=0;s<n.length;s++){r=n[s].substring(0,1).toUpperCase();i=n[s].substring(1);o[s]=r+i}u=o.join(" ");return u}function f(){$.trim(u("ttl"))!==""&&$(".title_bar").html(a($.trim(u("ttl")).replace(/\_+/g," ")));$.trim(u("intro"))!==""&&Number($.trim(u("intro")))&&(n=$.trim(u("intro")));$.trim(u("w"))!==""&&(e=Number($.trim(u("w"))));$.trim(u("h"))!==""&&(t=Number($.trim(u("h"))));$.trim(u("dl"))!==""&&(r=$.trim(u("dl")).split(""))}function l(){var e=window.location.href,t;console.log("URL to parse: "+e);t=e.split("?");t=t[0].split("/");t=t[t.length-1].replace(".html","");console.log("Parse result: "+t)}function c(){$(".video_holder").html('<video id="gvp_video" class="video-js vjs-default-skin" controls preload="metadata" poster="'+o+'.jpg"></video>');videojs("gvp_video",{},function(){i=this;this.progressTips();this.width(e);this.height(t);this.src({type:"video/mp4",src:"intros/"+n+".mp4"})});i.on("error",function(){this.dispose();$(".video_holder").html('<p class="error">Video Error: intro video not found!<small>Intro video code '+n+" is not found or does not exist on the centralized location. Please double check the intro video code table for the correct intro video number.</small></p>")});i.on("ended",function(){this.dispose();h()})}function h(r){if(typeof r=="undefined"||typeof r===null)r=!1;r?$(".video_holder").html('<video id="gvp_video" class="video-js vjs-default-skin" controls poster="'+o+'.jpg"><track src="'+o+'.vtt" kind="subtitles" srcland="en" label="English" default /></video>'):$(".video_holder").html('<video id="gvp_video" class="video-js vjs-default-skin" controls><track src="'+o+'.vtt" kind="subtitles" srcland="en" label="English" default /></video>');videojs("gvp_video",{},function(){s=this;this.progressTips();this.width(e);this.height(t);this.src({type:"video/mp4",src:o+".mp4"});n&&this.play()});s.on("error",function(){this.dispose();$(".video_holder").html('<p class="error">Video Error: video not found!<small>Video file '+o+".mp4 is not found or does not exist. Please double check the name of the directory, which holds the video. The name of the directory must the same with the video.</small></p>")});s.on("ended",function(){this.currentTime(0);$(".vjs-poster").delay(6e3).queue(function(){$(this).css("background-image","url("+o+".jpg)").html('<span class="replay-button"></span>').show()})})}function p(e,t){var n;t==="pdf"?n="application/pdf":t==="mp3"?n="audio/mpeg":t==="mp4"&&(n="video/mp4");$.ajax({url:e+"."+t,type:"HEAD",dataType:"text",contentType:n,async:!1,beforeSend:function(e){e.overrideMimeType(n);e.setRequestHeader("Accept",n)},success:function(){var n=e,r=$("#download_bar ul");if(location.protocol==="http:"){var i=window.location.href;i=i.substr(0,i.lastIndexOf("/")+1).replace("https","http");n=i+e}t==="pdf"?r.append('<li><a href="'+n+"."+t+'" target="_blank">Transcript</a></li>'):t==="mp3"?r.append('<li><a href="'+n+"."+t+'" target="_blank">MP3</a></li>'):t==="mp4"&&r.append('<li><a href="'+n+"."+t+'" target="_blank">Video</a></li>')},error:function(){var e;t==="pdf"?e="Transcript":t==="mp3"?e="MP3":t==="mp4"&&(e="Video");e+=" pending...";$("#download_bar ul").before("<p>"+e+"</p>")}})}function d(e,t){if(e!==null)for(var n=0;n<e.length;n++)switch(e[n]){case"v":p(o,"mp4");break;case"a":p(o,"mp3");break;case"t":p(o,"pdf")}}function v(){var e=navigator.userAgent,t={ios:e.match(/(iPad|iPhone|iPod)/g),blackberry:e.match(/BlackBerry/),android:e.match(/Android/),window:e.match(/IEMobile/)};return t.ios||t.blackberry||t.android?!0:!1}var e=640,t=360,n=0,r=null,i,s,o="smgt370_course_intro";f();l();if(!v()||u("m")!==0&&u("m")!==""){n?c():h(!0);$(".video_holder").on("click",function(){$(".title_bar").hide()})}else $(".video_holder").css({"background-image":"url("+o+".jpg)",width:e+"px",height:t+"px",cursor:"pointer"}).html('<span class="newWindow-button"></span>').on("click",function(){var e=window.location.href;e=e.replace("https","http").replace(/intro=[0-9]+/g,"intro=0");window.location.search?e+="&m=1":e+="?m=1";window.open(e)});d(r)});